---
import EmailIcon from "#assets/icons/EmailIcon.astro";
import FacebookIcon from "#assets/icons/FacebookIcon.astro";
import InstagramIcon from "#assets/icons/InstagramIcon.astro";
import PhoneIcon from "#assets/icons/PhoneIcon.astro";
import TiktokIcon from "#assets/icons/TiktokIcon.astro";
import Layout from "#layouts/Layout.astro";
---

<Layout title="Contact Us">
  <div class="flex flex-col py-8 px-4 sm:py-12 sm:px-6 md:py-20 md:px-8">
    <div class="text-center mb-8 sm:mb-12">
      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-primary mb-3">
        Get in Touch
      </h1>
      <p class="text-sm sm:text-base text-secondary max-w-2xl mx-auto">
        We'd love to hear from you! Fill out the form below or contact us
        directly.
      </p>
    </div>

    <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
      <div class="flex-1">
        <div class="bg-white rounded-lg border border-light-bg p-6 sm:p-8">
          <form method="POST" id="contact-us-form" class="space-y-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <div>
                <label
                  for="name"
                  class="block text-md font-bold text-primary mb-2"
                >
                  Full name
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  placeholder="Enter your full name"
                  class="w-full px-4 py-3 text-primary rounded-lg border border-light-bg focus:outline-none focus:ring-2 focus:ring-badge focus:border-transparent placeholder-secondary"
                  required
                />
                <p id="error-name" class="mt-1 text-sm text-red-600 hidden"></p>
              </div>

              <div>
                <label
                  for="mail"
                  class="block text-md font-bold text-primary mb-2"
                >
                  Email
                </label>
                <input
                  type="email"
                  id="mail"
                  name="mail"
                  placeholder="Enter your email address"
                  class="w-full px-4 py-3 rounded-lg text-primary border border-light-bg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent
                  placeholder-secondary"
                  required
                />
                <p id="error-mail" class="mt-1 text-sm text-red-600 hidden"></p>
              </div>
            </div>

            <div>
              <label
                for="message"
                class="block text-md font-bold text-primary mb-2"
              >
                Message
              </label>
              <textarea
                id="message"
                name="message"
                rows="6"
                placeholder="10 - 200 characters."
                class="w-full px-4 py-3 rounded-lg text-primary border border-light-bg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent resize-none placeholder-secondary"
                required></textarea>
              <p id="error-message" class="mt-1 text-sm text-red-600 hidden">
              </p>
            </div>

            <input type="text" name="website" class="hidden" />

            <button
              type="submit"
              id="submit-btn"
              class="w-full sm:w-auto px-6 py-3 bg-btn-primary hover:bg-primary text-light-bg font-semibold rounded-lg transition-colors duration-250 disabled:opacity-50 disabled:cursor-not-allowed border-2 border-filter cursor-pointer ease-in-out hover:border-2 hover:border-secondary hover:text-light-bg"
            >
              Send Message
            </button>
            <div id="form-message" class="mt-4 hidden"></div>
          </form>
        </div>
      </div>

      <div
        class="flex flex-col mx-auto lg:mx-0 max-w-md lg:max-w-none space-y-6 sm:space-y-8"
      >
        <div class="flex gap-4 items-start">
          <div class="shrink-0">
            <div
              class="w-12 h-12 bg-btn-primary rounded-full flex items-center justify-center"
            >
              <EmailIcon class={"w-6 h-6 text-light-bg"} />
            </div>
          </div>
          <div class="text-left">
            <h2 class="text-lg font-bold text-primary mb-1">Email</h2>
            <p class="text-md font-semibold text-secondary mb-1">
              Our team is here to help.
            </p>
            <a
              href="mailto:info@alefoods.pe"
              class="text-md text-accent font-bold hover:text-accent/90 hover:underline"
            >
              info@alefoods.pe
            </a>
          </div>
        </div>

        <div class="flex gap-4 items-start">
          <div class="shrink-0">
            <div
              class="w-12 h-12 bg-btn-primary rounded-full flex items-center justify-center"
            >
              <PhoneIcon class={"size-6 text-light-bg"} />
            </div>
          </div>
          <div class="text-left">
            <h2 class="text-lg font-bold text-primary mb-1">Phone</h2>
            <p class="text-md font-semibold text-secondary mb-1">
              Mon-Fri from 9am to 6pm.
            </p>
            <a
              href="tel:+51987654321"
              class="text-md text-accent font-bold hover:text-accent/90 hover:underline"
            >
              +51 987 654 321
            </a>
          </div>
        </div>

        <div class="pt-4 text-left">
          <h2 class="text-xl font-bold text-primary mb-4">Follow Us</h2>
          <div class="flex gap-3">
            <a
              aria-label="Facebook"
              href="https://www.facebook.com/alefoodsperu"
              target="_blank"
              class="w-10 h-10 bg-btn-primary rounded-full flex items-center justify-center transition-colors ease-out duration-350 hover:bg-body-bg hover:border-btn-primary hover:border-2 group"
            >
              <FacebookIcon
                class={"size-5 text-body-bg  group-hover:text-btn-primary"}
              />
            </a>
            <a
              aria-label="TikTok"
              href="https://www.tiktok.com/@irides.pe"
              target="_blank"
              class="w-10 h-10 bg-btn-primary rounded-full flex items-center justify-center transition-colors ease-out duration-350 hover:bg-body-bg hover:border-btn-primary hover:border-2 group"
            >
              <TiktokIcon
                class={"size-5 text-body-bg  group-hover:text-btn-primary"}
                color={"#0D2C54"}
              />
            </a>
            <a
              aria-label="Instagram"
              href="https://www.instagram.com/irides.pe"
              target="_blank"
              class="w-10 h-10 bg-btn-primary rounded-full flex items-center justify-center transition-colors ease-out duration-350 hover:bg-body-bg hover:border-btn-primary hover:border-2 group"
            >
              <InstagramIcon
                class={"size-5 text-body-bg  group-hover:text-btn-primary"}
              />
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  import { actions } from "astro:actions";
  import { isInputError } from "astro:actions";

  const form = document.getElementById("contact-us-form");
  const messageDiv = document.getElementById("form-message");
  const submitBtn = document.getElementById("submit-btn") as HTMLButtonElement;

  const errorName = document.getElementById("error-name");
  const errorMail = document.getElementById("error-mail");
  const errorMessage = document.getElementById("error-message");

  function clearErrors() {
    if (errorName) {
      errorName.textContent = "";
      errorName.classList.add("hidden");
    }
    if (errorMail) {
      errorMail.textContent = "";
      errorMail.classList.add("hidden");
    }
    if (errorMessage) {
      errorMessage.textContent = "";
      errorMessage.classList.add("hidden");
    }
  }

  function showInputErrors(errorFields: Record<string, string[] | undefined>) {
    clearErrors();

    if (errorFields.name && errorFields.name.length > 0 && errorName) {
      errorName.textContent = errorFields.name[0];
      errorName.classList.remove("hidden");
    }
    if (errorFields.mail && errorFields.mail.length > 0 && errorMail) {
      errorMail.textContent = errorFields.mail[0];
      errorMail.classList.remove("hidden");
    }
    if (errorFields.message && errorFields.message.length > 0 && errorMessage) {
      errorMessage.textContent = errorFields.message[0];
      errorMessage.classList.remove("hidden");
    }
  }

  if (form && form instanceof HTMLFormElement && submitBtn) {
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!messageDiv) return;

      clearErrors();
      messageDiv.classList.add("hidden");

      submitBtn.disabled = true;
      submitBtn.textContent = "Enviando...";

      try {
        const sendFormData = new FormData(form);

        const result = await actions.send(sendFormData);

        if (result.data?.success) {
          messageDiv.className =
            "mt-4 p-4 bg-green-50 border border-green-200 text-green-800 rounded-lg";
          messageDiv.textContent = "âœ… Message sent successfully!";
          messageDiv.classList.remove("hidden");
          form.reset();
          clearErrors();

          setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = "Send Message";
          }, 3000);

          setTimeout(() => {
            messageDiv.classList.add("hidden");
          }, 4000);
        } else if (result.error && isInputError(result.error)) {
          showInputErrors(result.error.fields);
          submitBtn.disabled = false;
          submitBtn.textContent = "Send Message";
        } else {
          submitBtn.disabled = false;
          submitBtn.textContent = "Send Message";
        }
      } catch (error) {
        console.error("Error:", error);
        submitBtn.disabled = false;
        submitBtn.textContent = "Send Message";
      }
    });
  }
</script>
